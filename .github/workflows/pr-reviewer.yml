name: Copilot PR Review

on:
  workflow_call:
    inputs:
      pr_number:
        description: "Review Target Pull Request Number"
        required: true
        type: number
      github_token:
        description: "GitHub Token for authentication"
        required: true
        type: string

jobs:
  copilot-review:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
      
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      # First we try using the built-in GitHub Copilot code review feature
      # This requires adding "Copilot" as a reviewer through GitHub UI
      # and is not directly triggerable through GitHub Actions
      - name: Add PR Review Comment
        uses: actions/github-script@v7
        with:
          github-token: ${{ inputs.github_token }}
          script: |
            // First, add a comment to indicate review is starting
            await github.rest.issues.createComment({
              ...context.repo,
              issue_number: ${{ inputs.pr_number }},
              body: "ğŸ‘‹ è‡ªå‹•ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’é–‹å§‹ã—ã¾ã™ã€‚å°‘ã€…ãŠå¾…ã¡ãã ã•ã„ã€‚"
            });
            
            // Request review from Copilot (this will add Copilot as a reviewer)
            try {
              await github.rest.pulls.requestReviewers({
                ...context.repo,
                pull_number: ${{ inputs.pr_number }},
                reviewers: ["copilot"]
              });
              console.log("Successfully requested review from Copilot");
            } catch (error) {
              console.log("Error requesting review from Copilot:", error);
              
              // If Copilot reviewer is not available, note it in a comment
              await github.rest.issues.createComment({
                ...context.repo,
                issue_number: ${{ inputs.pr_number }},
                body: "âš ï¸ GitHub Copilotã§ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚ä»£æ›¿ã®AIãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼ã§ç¶šè¡Œã—ã¾ã™ã€‚"
              });
            }
